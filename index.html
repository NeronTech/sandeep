<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Sandeeps — Smoothies & Snacks</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Manifest & Icons -->
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="icons/favicon.svg" type="image/svg+xml" />
    <meta name="theme-color" content="#F8EDEB" />

    <!-- iOS PWA support -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Sandeeps" />
    <link rel="apple-touch-icon" href="icons/web-app-manifest-512x512.png" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body
    class="min-h-screen bg-rose-50 text-gray-900 flex flex-col items-center p-6"
  >
    <h2 class="text-2xl font-bold mb-6 text-orange-600 text-center">
      🍓 Sandeeps — Smoothies & Snacks
    </h2>

    <form
      id="registerForm"
      class="bg-white shadow-md rounded-2xl p-6 w-full max-w-sm"
    >
      <input
        type="text"
        id="name"
        placeholder="Name"
        required
        class="w-full mb-3 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-400 outline-none"
      />
      <input
        type="email"
        id="email"
        placeholder="Email"
        required
        class="w-full mb-4 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-400 outline-none"
      />
      <button
        type="submit"
        class="w-full bg-orange-500 hover:bg-orange-600 text-white font-semibold py-2 rounded-lg transition"
      >
        Register
      </button>
    </form>

    <div id="message" class="mt-3 text-center font-semibold"></div>

    <div class="border-t w-4/5 my-8"></div>

    <h3 class="text-lg font-semibold mb-2 text-orange-600">All Users</h3>
    <button
      id="loadUsers"
      class="bg-orange-400 hover:bg-orange-500 text-white px-5 py-2 rounded-lg mb-4 transition"
    >
      Load Users
    </button>
    <pre
      id="userList"
      class="bg-white p-4 shadow rounded-xl w-full max-w-sm text-sm overflow-auto"
    ></pre>

    <!-- Scripts -->
    <script>
      // 🔗 Replace with your Google Apps Script Web App URL
      const GAS_URL =
        "https://script.google.com/macros/s/AKfycbz9MnudbIrTnhwMGcBFhekITPu17mk43wTyTRyKbAzJGFVxn9lddMLCSVJDZwaYz_zU/exec";

      const registerForm = document.getElementById("registerForm");
      const message = document.getElementById("message");
      const userList = document.getElementById("userList");

      // === Register user ===
      registerForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("name").value.trim();
        const email = document.getElementById("email").value.trim();
        message.textContent = "⏳ Sending...";
        message.className = "mt-3 text-center text-gray-600";

        try {
          const res = await fetch(GAS_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email }),
          });
          const result = await res.json();
          message.textContent = result.message || "Registration complete!";
          message.className =
            "mt-3 text-center font-semibold " +
            (result.success ? "text-green-600" : "text-red-600");
        } catch (err) {
          message.textContent = "Error: " + err.message;
          message.className = "mt-3 text-center text-red-600";
        }
      });

      // === Load all users ===
      document
        .getElementById("loadUsers")
        .addEventListener("click", async () => {
          try {
            const res = await fetch(GAS_URL);
            const data = await res.json();
            userList.textContent = JSON.stringify(data.users, null, 2);
          } catch (err) {
            userList.textContent = "Error loading users: " + err.message;
          }
        });

      // === PWA Support ===
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker
          .register("/sw.js")
          .then((reg) =>
            console.log("✅ Service Worker registered:", reg.scope)
          )
          .catch((err) => console.warn("SW registration failed:", err));
      }

      let deferredPrompt;
      window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault();
        deferredPrompt = e;
        const btn = document.createElement("button");
        btn.textContent = "Install Sandeeps App";
        btn.className =
          "fixed bottom-5 left-1/2 -translate-x-1/2 px-6 py-3 bg-orange-500 text-white font-semibold rounded-xl shadow-lg";
        document.body.appendChild(btn);
        btn.addEventListener("click", async () => {
          btn.remove();
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log("User response to install:", outcome);
          deferredPrompt = null;
        });
      });

      // === iOS "Add to Home Screen" hint ===
      if (/iphone|ipad|ipod/i.test(navigator.userAgent)) {
        setTimeout(() => {
          alert(
            "To install Sandeeps, tap the Share icon (⬆️) then “Add to Home Screen”."
          );
        }, 2000);
      }
    </script>
  </body>
</html>
